"use strict";(self["webpackChunkhello_world"]=self["webpackChunkhello_world"]||[]).push([[589],{589:function(e,t,s){s.r(t),s.d(t,{default:function(){return k}});var n=s(252),l=s(577),o=s(963);const i=e=>((0,n.dD)("data-v-b28aeb60"),e=e(),(0,n.Cn)(),e),c={class:"banner"},a=i((()=>(0,n._)("div",{class:"logo"},[(0,n._)("img",{src:"https://i.imgur.com/jyXZ7vo.png",alt:""}),(0,n._)("span",null,"4chat")],-1))),r={class:"status",title:"Connection status to the server."},u={class:"statusTex"},d={class:"chatlist",ref:"chatList"},h={class:"tableclass"},m=i((()=>(0,n._)("tr",null,[(0,n._)("th",{class:"author_col"},"Author"),(0,n._)("th",null,"Message")],-1))),g=["onClick"],p={key:0},U=["disabled"],_=["disabled"],f={class:"editUsernameModal"},v=["value"],w=i((()=>(0,n._)("input",{type:"submit",value:"save"},null,-1))),y={class:"paletteTable"},C=["onClick"];function b(e,t,s,i,b,M){return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",c,[a,(0,n._)("div",r,[(0,n._)("div",{class:"statusIndicator",style:(0,l.j5)({background:M.indicatorColor})},null,4),(0,n._)("span",u,(0,l.zw)(b.statusText||"Loading"),1)])]),(0,n._)("div",d,[(0,n._)("table",h,[m,((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(b.messages,((e,t)=>((0,n.wg)(),(0,n.iD)("tr",{key:t,class:(0,l.C_)({systemRow:M.isSystem(e["id"])})},[(0,n._)("td",{class:"author_col",onClick:t=>M.editUser(e["id"]),style:(0,l.j5)({cursor:M.isSystem(e["id"])?"":"pointer",color:b.localUserColours[e["id"]]||"#2c3e50"})},[(0,n._)("span",null,(0,l.zw)(b.localUsers[e["id"]]||e["author"]||"FAILED"),1),M.isSystem(e["id"])?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("span",p,"#"+(0,l.zw)(e["id"]),1))],12,g),(0,n._)("td",null,(0,l.zw)(e["message"]||"FAILED"),1)],2)))),128))])],512),(0,n._)("form",{class:"inputs",onSubmit:t[0]||(t[0]=(0,o.iM)(((...e)=>M.sendMessage&&M.sendMessage(...e)),["prevent"]))},[(0,n._)("input",{class:"textInput",maxlength:"495",ref:"textInput",type:"text",disabled:!M.canMessage},null,8,U),(0,n._)("input",{class:"submitInput",type:"submit",disabled:!M.canMessage},null,8,_)],32),(0,n.wy)((0,n._)("div",{class:"modalCover",onClick:t[1]||(t[1]=(...e)=>M.closeAllModals&&M.closeAllModals(...e))},null,512),[[o.F8,M.anyModalOpen]]),(0,n.wy)((0,n._)("div",f,[(0,n._)("h3",null,"Edit "+(0,l.zw)(M.getLocalUser(b.selectedUser))+"#"+(0,l.zw)(b.selectedUser),1),(0,n._)("form",{onSubmit:t[2]||(t[2]=(0,o.iM)(((...e)=>M.finishEditUserData&&M.finishEditUserData(...e)),["prevent"]))},[(0,n._)("input",{ref:"inputUsernameEdit",type:"name",value:M.getLocalUser(b.selectedUser)},null,8,v),w],32),(0,n._)("table",y,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(b.userColourPalette,((e,t)=>((0,n.wg)(),(0,n.iD)("tr",{key:t},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e,((e,t)=>((0,n.wg)(),(0,n.iD)("td",{key:t},[(0,n._)("div",{class:"paletteColour",style:(0,l.j5)({background:e}),onClick:t=>M.editUserColour(e)},null,12,C)])))),128))])))),128))])],512),[[o.F8,null!=b.selectedUser]])],64)}var M={data(){return{connection:null,messages:[],newMessages:0,connectionStatus:2,statusText:"Loading",documentOldName:"",localUsers:{},localUserColours:{},reconnector:null,documentNamer:null,selectedUser:null,userColourPalette:[["#800","#880","#109","#07e"],["#809","#117705","#804408","#2c3e50"]]}},mounted(){this.connect(),this.documentOldName=document.title,this.start_reconnector(),this.documentNamer=setInterval(this.documentNameLoop,500),document.documentElement.style.setProperty("--vh",`${window.innerHeight}px`)},unmounted(){this.connection.close(1e3),clearInterval(this.reconnector),clearInterval(this.documentNamer),document.title=this.documentOldName},watch:{connection(e){null==e?this.start_reconnector():clearInterval(this.reconnector)},connectionStatus(e,t){1==e||1==t&&this.messages.push({id:0,author:"CLIENT",message:"LOST CONNECTION"})}},methods:{connect(){this.connection=new WebSocket("wss://websocket-server.creepreplit.repl.co/"),this.connection.onmessage=e=>{const t=JSON.parse(e.data),s=this.getLocalUser(t["id"]);if("message"==t["type"]){let e=t["author"]||`${s}`;this.messages.push({id:t["id"],author:e,message:t["content"]}),document.hasFocus()||(this.newMessages+=1);const n=this.$refs.chatList,l=n.scrollHeight-n.clientHeight-n.scrollTop;l<10&&setTimeout((()=>{n.scrollTo(0,n.scrollHeight)}),0)}else"info"==t["type"]?this.statusText=`Online ${t["user_count"]}`:(this.messages.push({id:0,author:"CLIENT",message:`UNKNOWN TYPE ${t["type"]}`}),console.log("BAD DATA",t))},this.connection.onclose=()=>{this.connection=null,this.connectionStatus=0,this.statusText="Offline"},this.connection.onopen=()=>{this.connection.send(JSON.stringify({type:"info"})),this.statusText="Connecting",this.connectionStatus=1}},sendMessage(){const e=this.$refs.textInput,t=e.value;""!=t&&(e.value="",this.connection.send(JSON.stringify({type:"message",content:t})))},start_reconnector(){this.reconnector=setInterval((()=>{this.connectionStatus=2,this.connect()}),5e3)},getLocalUser(e){if(null==e)return;if(e<=1e3)return;const t=this.localUsers[e];if(t)return t;const s="User";return this.localUsers[e]=s,s},editUser(e){e<=1e3||(this.selectedUser=e,setTimeout((()=>this.$refs.inputUsernameEdit.focus()),0))},closeAllModals(){this.selectedUser=null},finishEditUserData(){const e=this.$refs.inputUsernameEdit;let t={...this.localUsers};t[this.selectedUser]=e.value,this.localUsers=t,this.selectedUser=null},editUserColour(e){let t={...this.localUsers};t[this.selectedUser]=e,this.localUserColours=t},isSystem(e){return e<=1e3},documentNameLoop(){document.hasFocus()&&(this.newMessages=0),this.newMessages?document.title=`(${this.newMessages}) 4Chat`:document.title="4Chat"}},computed:{indicatorColor(){return 0==this.connectionStatus?"#f33":1==this.connectionStatus?"#8f2":"#fff"},canMessage(){return 1==this.connectionStatus},anyModalOpen(){return null!=this.selectedUser}}},N=s(744);const S=(0,N.Z)(M,[["render",b],["__scopeId","data-v-b28aeb60"]]);var k=S}}]);
//# sourceMappingURL=589.163765ab.js.map